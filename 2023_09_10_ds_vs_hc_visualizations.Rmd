---
title: "2023_09_10 Seurat subset of DS vs HC donors"
#output: html_notebook
---

This notebook will subset our initial Seurat object, made of 2 downs syndome (ds) and two healthy controls (hc). We will make subsets of the individual donors and then do some visual comparison of gene expression.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries

```{r libraries}
suppressPackageStartupMessages({
library(Seurat)
library(tidyverse)
library(qs)
})
```

# Read in data: Post Anchor SCT Object

```{r read in post anchor seurat}
SCT_data_object = qread("data/SCT_data_object_Post_Anchored.qs", nthreads = 10)
```

# Initial look at cells per sample

Look at the breakdown of predicted cells by sample:

```{r predicted.ids/sample}
SCT_data_object@meta.data |>  
  group_by(predicted.id) |> 
  count(orig.ident) |> 
  pivot_wider(names_from = orig.ident, values_from = n)
```

```{r create group in metadata}
ds_samples <- c("ds_tn_67", "ds_tn_6865")
#hc_samples <- c("hc_65", "hc_69")

SCT_data_object@meta.data <- SCT_data_object@meta.data |> 
  dplyr::mutate(group = ifelse(orig.ident %in% ds_samples, "ds", "hc"),
                .after = orig.ident)
```

Run this chunk if removing ds_tn_6865 is desired.

```{r remove ds_6865}
Idents(SCT_data_object) <- "orig.ident"
SCT_data_object <- subset(SCT_data_object, idents = c("hc_65", "hc_69","ds_tn_67"))
```

# Visualization

```{r cluster subsets}
Idents(SCT_data_object) <- "predicted.id"
m1.mac <- subset(SCT_data_object, idents = c("M1 Macrophages"))
```


## Subset visualizations

### M1 Macrophages

```{r }
VlnPlot(m1.mac,
        features = "VEGFA",
        group.by = "orig.ident",
        sort = "increasing") + 
  theme(legend.position = 'none',
        axis.text = element_text(size=8))
ggsave(filename = "Analysis_2023_09_10/plots/m1.mac.VEGFA.by.sample.png",
       width = 11,
       height = 8,
       units = "in")
```

```{r }
VlnPlot(m1.mac,
        features = "VEGFA",
        group.by = "group",
        sort = "increasing") + 
  theme(legend.position = 'none',
        axis.text = element_text(size=8))
ggsave(filename = "Analysis_2023_09_10/plots/m1.mac.VEGFA.by.condition.png",
       width = 11,
       height = 8,
       units = "in")
```














